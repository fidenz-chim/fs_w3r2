# Javascript Node CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-javascript/ for more details
#
version: 2
jobs:
   # The build job
  build:
    docker:
      - image: circleci/node:7.10
    working_directory: ~/repo
    steps:
        - checkout

    # Download and cache dependencies
        - restore_cache:
            keys:
                v1_dependencies_{{ checksum "package.json" }}
                v1_dependencies_
        - run: npm install
        - save_cache:
              paths:
                  node_modules
              key: v1_dependencies_{{ checksum "package.json" }}
        # run tests!
        - run: npm test

  deploy:
    working_directory: ~/repo
    docker:
        - image: circleci/node:7.10
    steps:
        - checkout
        - run:
            name: Deploy Master to Heroku
            command: git push https://heroku:${HEROKU_API_KEY}@git.heroku.com/${HEROKU_APP_NAME}.git master

workflows:
  version: 2
  build-deploy:
    jobs:
      - build
      - deploy:
          requires:
            - build
          filters:
            branches:
              only: master
  #  # The deploy job
  # deploy:
  #   working_directory: ~/repo
  #   docker:
  #       - image: circleci/node:7.10
  #   steps:
  #       # Log the current branch
  #       - run:
  #           name: Show current branch
  #           command: echo ${CIRCLE_BRANCH}
  #       # Restore cache from the build job which contains the
  #       # dist folder that needs to be deployed
  #       - restore_cache:
  #           key: v1-dist-{{ .Environment.CIRCLE_BRANCH }}-{{ .Environment.CIRCLE_SHA1 }}
  #       # Install AWS cli
  #       - run:
  #           name: Deploy to Heroku
  #           command: git push https://heroku:${HEROKU_API_KEY}@git.heroku.com/${HEROKU_APP_NAME}.git master
